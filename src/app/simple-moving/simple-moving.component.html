<div class="container-fluid mt-4" style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; padding: 2rem;">
  
  <!-- Header Card -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
        <div class="card-body">
          <h2 class="mb-2"><i class="fas fa-wave-square"></i> Simple Moving Averages (SMA) Analysis</h2>
          <p class="mb-0" style="opacity: 0.9;">Track SMA 20, 50 & 200 crossovers and trends</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Refresh Button -->
  <div class="row mb-3">
    <div class="col-12">
      <button class="btn btn-primary btn-lg" (click)="refreshData()" [disabled]="isLoading"
              style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 12px 30px; font-weight: 600;">
        <i class="fas fa-sync-alt" [class.fa-spin]="isLoading"></i> 
        {{ isLoading ? 'Loading...' : 'Refresh Data' }}
      </button>
      <span *ngIf="isLoading" class="ml-3 text-muted">
        <i class="fas fa-spinner fa-spin"></i> Fetching latest data...
      </span>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
      <span class="sr-only">Loading...</span>
    </div>
    <p class="mt-3 text-muted">Loading SMA data...</p>
  </div>

  <!-- Control Panel -->
  <div class="row mb-4" *ngIf="!isLoading">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
          <h5 class="mb-0"><i class="fas fa-sliders-h"></i> Filters & Query Builder</h5>
        </div>
        <div class="card-body" style="background: #f8f9fa;">
          <div class="row align-items-end">
            <!-- Search Input -->
            <div class="col-lg-3 col-md-6 mb-3">
              <label class="form-label fw-bold"><i class="fas fa-search"></i> Search Stocks</label>
              <input 
                class="form-control form-control-lg" 
                type="text" 
                [(ngModel)]="searchQuery"
                (input)="onSearchInputChange()" 
                placeholder="ðŸ” Search by stock name..."
                style="border-radius: 10px; border: 2px solid #e0e0e0;">
            </div>

            <!-- Price Range Slider Filter -->
            <div class="col-lg-3 col-md-6 mb-3">
              <label class="form-label fw-bold"><i class="fas fa-rupee-sign"></i> Price Range Filter</label>
              <div class="price-slider-container">
                <div class="d-flex justify-content-between mb-2">
                  <small class="text-muted fw-bold">â‚¹{{ minPrice | number:'1.0-0' }}</small>
                  <small class="text-muted fw-bold">â‚¹{{ maxPrice | number:'1.0-0' }}</small>
                </div>
                <div class="dual-range-slider">
                  <input 
                    type="range" 
                    class="form-range price-slider min-slider" 
                    [(ngModel)]="minPriceFilter"
                    [min]="minPrice"
                    [max]="maxPrice"
                    (input)="onPriceFilterChange()"
                    (mousedown)="bringToFront('min')"
                    (touchstart)="bringToFront('min')">
                  <input 
                    type="range" 
                    class="form-range price-slider max-slider" 
                    [(ngModel)]="maxPriceFilter"
                    [min]="minPrice"
                    [max]="maxPrice"
                    (input)="onPriceFilterChange()"
                    (mousedown)="bringToFront('max')"
                    (touchstart)="bringToFront('max')">
                </div>
                <div class="d-flex justify-content-between align-items-center mt-2">
                  <span class="badge bg-primary px-3 py-2">â‚¹{{ minPriceFilter | number:'1.0-0' }}</span>
                  <span class="badge bg-success px-3 py-2">â‚¹{{ maxPriceFilter | number:'1.0-0' }}</span>
                </div>
                <div class="text-center mt-2">
                  <small class="text-muted fw-bold">
                    <i class="fas fa-filter"></i> {{ filteredByPriceCount }} stocks in range
                  </small>
                </div>
              </div>
            </div>

            <!-- Query Builder -->
            <div class="col-lg-4 col-md-8 mb-3">
              <label class="form-label fw-bold"><i class="fas fa-code"></i> Advanced Query</label>
              <textarea 
                class="form-control" 
                rows="3" 
                [(ngModel)]="query"
                placeholder="e.g., close > 1000 && RSI < 30"
                style="font-family: 'Monaco', 'Courier New', monospace; border-radius: 10px; border: 2px solid #e0e0e0; font-size: 13px;"></textarea>
              <small class="text-muted d-block mt-1">
                <i class="fas fa-info-circle"></i> <strong>Keys:</strong> low, close, sma20, sma50, godFather, volume, RSI, MACD, HIGH52, VWAP, sector
              </small>
            </div>

            <!-- Action Buttons -->
            <div class="col-lg-2 col-md-4 mb-3">
              <label class="form-label fw-bold"><i class="fas fa-cog"></i> Actions</label>
              <div class="d-grid gap-2">
                <button type="button" (click)="querySearch()" class="btn btn-success">
                  <i class="fas fa-play"></i> Execute
                </button>
                <button type="button" (click)="nearSMA()" class="btn btn-primary">
                  <i class="fas fa-filter"></i> SMA Filter
                </button>
                <button type="button" (click)="near2050SMA()" class="btn btn-info">
                  <i class="fas fa-wave-square"></i> SMA 20/50
                </button>
              </div>
            </div>
          </div>

          <!-- Quick Action Buttons -->
          <div class="row mt-3 pt-3 border-top">
            <div class="col-12">
              <div class="d-flex gap-2 justify-content-start">
                <button type="button" (click)="onBtnExport()" class="btn btn-dark">
                  <i class="fas fa-file-csv"></i> Export CSV
                </button>
                <button type="button" (click)="reset()" class="btn btn-danger">
                  <i class="fas fa-redo"></i> Reset Filters
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="!rowData || rowData.length === 0" class="text-center py-5">
    <div class="card">
      <div class="card-body">
        <div class="spinner-grow text-primary" role="status" style="width: 3rem; height: 3rem;"></div>
        <p class="mt-3 text-muted">Loading SMA data...</p>
      </div>
    </div>
  </div>

  <!-- Data Grid -->
  <div *ngIf="rowData && rowData.length > 0" class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header text-white" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
              <i class="fas fa-table"></i> 
              {{ showingPatterns ? 'ðŸŽ¯ Best SMA200 Patterns' : 'ðŸ“Š All SMA200 Filter Results' }}
            </h5>
            <div class="d-flex gap-2 align-items-center">
              <button 
                *ngIf="!showingPatterns && smaPatterns.length > 0" 
                class="btn btn-sm btn-light"
                (click)="showPatternsOnly()"
                style="font-weight: 600;">
                <i class="fas fa-filter"></i> Show Patterns ({{smaPatterns.length}})
              </button>
              <button 
                *ngIf="showingPatterns && filteredallData.length > 0" 
                class="btn btn-sm btn-light"
                (click)="showAllFiltered()"
                style="font-weight: 600;">
                <i class="fas fa-list"></i> Show All ({{filteredallData.length}})
              </button>
              <span class="badge badge-light">{{rowData.length}} stocks</span>
            </div>
          </div>
        </div>
        <div class="card-body">
          <ag-grid-angular 
            class="ag-theme-quartz" 
            style="height: 600px;width: 100%" 
            [rowData]="rowData"
            [suppressExcelExport]="true" 
            [rowSelection]="rowSelection" 
            [gridOptions]="gridOptions" 
            [pagination]="pagination"
            [defaultColDef]="defaultColDef" 
            [paginationPageSize]="paginationPageSize"
            [domLayout]="'normal'" 
            [columnDefs]="colDefs"
            (gridReady)="onGridReady($event)">
          </ag-grid-angular>
        </div>
      </div>
    </div>
  </div>

  <!-- Information Cards -->
  <div class="row mt-4">
    <div class="col-md-4">
      <div class="card" style="border-left: 5px solid #10b981;">
        <div class="card-body">
          <h6><i class="fas fa-crosshairs"></i> SMA200 Position</h6>
          <p class="mb-0"><strong>ðŸŸ¢ Bouncing Above:</strong> Bullish bounce off SMA200</p>
          <p class="mb-0"><strong>ðŸ”´ Testing Below:</strong> Bearish rejection at SMA200</p>
          <p class="mb-0"><strong>ï¿½ On SMA200:</strong> Price at support level</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card" style="border-left: 5px solid #f59e0b;">
        <div class="card-body">
          <h6><i class="fas fa-fire"></i> Pattern Strength</h6>
          <p class="mb-0"><strong>ï¿½ Strong Cross:</strong> 85 (Best!)</p>
          <p class="mb-0"><strong>ðŸ’š Hammer:</strong> 75 (Strong)</p>
          <p class="mb-0"><strong>ï¿½ Shooting Star:</strong> 60 (Bearish)</p>
          <p class="mb-0"><strong>ï¿½ Spinning Top:</strong> 55 (Neutral)</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card" style="border-left: 5px solid #8b5cf6;">
        <div class="card-body">
          <h6><i class="fas fa-lightbulb"></i> Trading Tip</h6>
          <p class="mb-0">Best setup: <strong>Strong Cross ðŸŸ¢</strong> + <strong>Bouncing Above</strong> = High probability SMA200 breakout!</p>
        </div>
      </div>
    </div>
  </div>

</div>